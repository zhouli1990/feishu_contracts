# 搜索合同

搜索合同。

## 请求

基本 | 
---|---
HTTP URL | https://open.feishu.cn/open-apis/contract/v1/contracts/search
HTTP Method | POST
接口频率限制 | [1000 次/分钟、50 次/秒](https://open.feishu.cn/document/ukTMukTMukTM/uUzN04SN3QjL1cDN)
支持的应用类型 | Custom App
权限要求<br>**调用该 API 所需的权限。开启其中任意一项权限即可调用** | 获取合同信息(contract:contract:readonly)
字段权限要求 | **注意事项**：该接口返回体中存在下列敏感字段，仅当开启对应的权限后才会返回；如果无需获取这些字段，则不建议申请<br>获取用户 user ID(contact:user.employee_id:readonly)

### 请求头

名称 | 类型 | 必填 | 描述
---|---|---|---
Authorization | string | 是 | `tenant_access_token`<br>**值格式**："Bearer `access_token`"<br>**示例值**："Bearer t-7f1bcd13fc57d46bac21793a18e560"<br>[了解更多：如何选择与获取 access token](https://open.feishu.cn/document/uAjLw4CM/ugTN1YjL4UTN24CO1UjN/trouble-shooting/how-to-choose-which-type-of-token-to-use)
Content-Type | string | 是 | **固定值**："application/json; charset=utf-8"

### 查询参数

名称 | 类型 | 必填 | 描述
---|---|---|---
user_id_type | string | 否 | 用户 ID 类型<br>**示例值**：open_id<br>**可选值有**：<br>- open_id：标识一个用户在某个应用中的身份。同一个用户在不同应用中的 Open ID 不同。[了解更多：如何获取 Open ID](https://open.feishu.cn/document/uAjLw4CM/ugTN1YjL4UTN24CO1UjN/trouble-shooting/how-to-obtain-openid)<br>- union_id：标识一个用户在某个应用开发商下的身份。同一用户在同一开发商下的应用中的 Union ID 是相同的，在不同开发商下的应用中的 Union ID 是不同的。通过 Union ID，应用开发商可以把同个用户在多个应用中的身份关联起来。[了解更多：如何获取 Union ID？](https://open.feishu.cn/document/uAjLw4CM/ugTN1YjL4UTN24CO1UjN/trouble-shooting/how-to-obtain-union-id)<br>- user_id：标识一个用户在某个租户内的身份。同一个用户在租户 A 和租户 B 内的 User ID 是不同的。在同一个租户内，一个用户的 User ID 在所有应用（包括商店应用）中都保持一致。User ID 主要用于在不同的应用间打通用户数据。[了解更多：如何获取 User ID？](https://open.feishu.cn/document/uAjLw4CM/ugTN1YjL4UTN24CO1UjN/trouble-shooting/how-to-obtain-user-id)<br>**默认值**：`open_id`<br>**当值为 `user_id`，字段权限要求**：<br>获取用户 user ID(contact:user.employee_id:readonly)

### 请求体

名称 | 类型 | 必填 | 描述
---|---|---|---
page_size | int | 否 | 分页大小<br>**示例值**：0
page_token | string | 否 | 分页标记，第一次请求不填，表示从头开始遍历；分页查询结果还有更多项时会同时返回新的 page_token，下次遍历可采用该 page_token 获取查询结果<br>**示例值**："tblKz5D60T4JlfcT"
contract_number | string | 否 | 合同编号。若传入该值，则忽略组合条件传参。<br>**示例值**："CT20210708000030"
combine_condition | contract_search_combine_condition | 否 | 组合条件
user_id | string | 否 | 用户id<br>**示例值**："ou_8ebd4f35d7101ffdeb4771d7c8ec517e"
permission | int | 否 | 权限关系<br>**示例值**：0<br>**可选值有**：<br>- 0：全部合同<br>- 1：我的可见合同<br>- 2：申请的合同
contract_status | int | 否 | 合同状态<br>**示例值**：3<br>**可选值有**：<br>- 0：editing<br>- 1：cancelled<br>- 2：revoked<br>- 3：process<br>- 4：rejected<br>- 5：approved<br>- 6：signing<br>- 7：signed<br>- 8：archiving<br>- 9：archived<br>- 10：changing<br>- 11：changed<br>- 12：我方已签约<br>- 13：对方已签约
pay_type | int | 否 | 收支类型<br>**示例值**：0<br>**可选值有**：<br>- 0：未知<br>- 1：收入类<br>- 2：支出类<br>- 3：收入支出类<br>- 4：无金额
contract_category_name | string | 否 | 合同类型名称<br>**示例值**："技术咨询合同"
contract_name | string | 否 | 合同名称<br>**示例值**："合同名称"
contract_number | string | 否 | 合同编号<br>**示例值**："CT20210708000030"
archive_number | string | 否 | 归档编号<br>**示例值**："AT20210708000030"
submited_time_start | string | 否 | 申请日期范围-开始时间，格式：yyyy-MM-dd HH:mm:ss<br>**示例值**："2021-10-01 11:11:11"
submited_time_end | string | 否 | 申请日期范围-结束时间，格式：yyyy-MM-dd HH:mm:ss<br>**示例值**："2021-10-01 11:11:11"
archived_time_start | string | 否 | 归档日期范围-开始时间，格式：yyyy-MM-dd HH:mm:ss<br>**示例值**："2021-10-01 11:11:11"
archived_time_end | string | 否 | 归档日期范围-结束时间，格式：yyyy-MM-dd HH:mm:ss<br>**示例值**："2021-10-01 11:11:11"
owner_user_id | string | 否 | 合同归属人id<br>**示例值**："ou_b1b355b3099b3c1fd4c937e151c4fdd5"
form | attribute_value\[\] | 否 | 字段属性值匹配。仅支持关联前置单据搜索。
attribute_name | string | 否 | 字段名称<br>**示例值**："受理人"
attribute_value | string | 否 | 字段值<br>**示例值**："6982118143107809580"
module_name | string | 否 | 模块名称<br>**示例值**："相关单据"
contract_status_in | string | 否 | 合同状态范围，数字含义参考contract_status，用逗号分割<br>**示例值**："1,2,3"
contract_category_abbreviation | string | 否 | 合同类型缩写<br>**示例值**："CUBG"

### 请求体示例
```json
{
    "page_size": 0,
    "page_token": "tblKz5D60T4JlfcT",
    "contract_number": "CT20210708000030",
    "combine_condition": {
        "user_id": "ou_8ebd4f35d7101ffdeb4771d7c8ec517e",
        "permission": 0,
        "contract_status": 3,
        "pay_type": 0,
        "contract_category_name": "技术咨询合同",
        "contract_name": "合同名称",
        "contract_number": "CT20210708000030",
        "archive_number": "AT20210708000030",
        "submited_time_start": "2021-10-01 11:11:11",
        "submited_time_end": "2021-10-01 11:11:11",
        "archived_time_start": "2021-10-01 11:11:11",
        "archived_time_end": "2021-10-01 11:11:11",
        "owner_user_id": "ou_b1b355b3099b3c1fd4c937e151c4fdd5",
        "form": [
            {
                "attribute_name": "受理人",
                "attribute_value": "6982118143107809580",
                "module_name": "相关单据"
            }
        ],
        "contract_status_in": "1,2,3",
        "contract_category_abbreviation": "CUBG"
    }
}
```

#### 合同搜索Form组件说明

| 类型       | 描述   |
| --------------- | ---------------------- |
| feishu_approval           | String值，Json序列化，id为单据id               |
````json
{
    "attribute_name": "外部单据",
    "module_name": "相关单据",
    "attribute_value": "{\"id\":\"B76A1A02-F768-4F2E-8A42-A0B2F2BADFEE\"}"
}
````

## 响应

### 响应体

名称 | 类型 | 描述
---|---|---
code | int | 错误码，非 0 表示失败
msg | string | 错误描述
data | \- | \-
items | contract_search_response\[\] | 合同信息
create_user_id | string | 创建人id,默认指openId
create_user_name | string | 创建人名称
contract_id | int | 合同id
contract_number | string | 合同编号
contract_name | string | 合同名称
amount | number(float) | 合同金额
our_party_list | our_party_resource\[\] | 我方主体列表
our_party_id | string | 我方主体id
our_party_name | string | 我方主体名称
our_party_code | string | 我方主体code
our_party_type_code | int | 我方主体类型编码<br>**可选值有**：<br>- 0：签约主体<br>- 1：付款主体
our_party_sign_info_resource | our_party_sign_info_base_resource | 我方签约信息
enable | boolean | 是否开启盖章
seal_type_codes | string | 盖章类型<br>**可选值有**：<br>- 0：无<br>- 1：公章<br>- 2：合同专用章<br>- 3：财务专用章<br>- 4：法定代表人章<br>- 5：人事专用章<br>- 20：自定义章
seal_position_type_code | int | 印章位置类型<br>**可选值有**：<br>- 0：关键字<br>- 1：拖拽<br>- 255：未指定
keyword | string | 签约关键字
date_seal_enabled | boolean | 是否盖日期章
date_seal_keyword | string | 日期章关键字
personal_seal_enabled | boolean | 是否盖人名章
personal_seal_keyword | string | 人名章关键字
cross_page_seal_enabled | boolean | 是否盖齐缝章
sign_status | string | 签约状态<br>**可选值有**：<br>- NOT_START：未发起<br>- START_SUCCESS：发起成功<br>- START_FAIL：发起失败<br>- SIGN_SUCCESS：签约成功<br>- SIGN_FAIL：签约失败<br>- SIGN_DECLINE：拒绝签约
counter_party_list | counter_party_resource\[\] | 对方主体列表
counter_party_id | string | 对方主体id
counter_party_name | string | 对方主体名称
counter_party_code | string | 对方主体code
business_address_info | business_address_info | 经营地址选择
id | string | 通过经营地址id选择具体经营地址
value | string | 通过经营地址详细地址选择具体经营地址 (如果无法获取经营地址id)
bank_account_info | bank_account_info | 银行账户选择
id | string | 通过银行账户id选择具体银行账号
value | string | 通过银行账号选择具体银行账号 (如果无法获取银行账号id)
contact_info | contact_info | 联系人选择
id | string | 通过联系人id选择具体联系人
value | string | 通过联系人姓名选择具体联系人(如果无法获取联系人id)
counter_party_sign_info_resource | counter_party_sign_info_base_resource | 对方签约信息
enable | boolean | 是否开启盖章
seal_type_codes | string | 盖章类型<br>**可选值有**：<br>- 0：无<br>- 1：公章<br>- 2：合同专用章<br>- 3：财务专用章<br>- 4：法定代表人章<br>- 5：人事专用章<br>- 20：自定义章
seal_position_type_code | int | 印章位置类型<br>**可选值有**：<br>- 0：关键字<br>- 1：拖拽<br>- 255：未指定
keyword | string | 签约关键字
date_seal_enabled | boolean | 是否盖日期章
date_seal_keyword | string | 日期章关键字
personal_seal_enabled | boolean | 是否盖人名章
personal_seal_keyword | string | 人名章关键字
cross_page_seal_enabled | boolean | 是否盖齐缝章
signer_name | string | 签约人姓名
signer_mobile | string | 签约人手机号
signer_email | string | 签约人邮箱
bank_accounts | bank_account_resource\[\] | 银行信息
account | string | 账号
account_name | string | 账户名
bank_code | string | 开户行编码
bank_name | string | 开户行名称
country | string | 开户行所在国家
selected | boolean | 是否被选中
register_address | register_address_resource | 注册地址
country | string | 注册国家
province | string | 注册省份
city | string | 注册城市
detail_address | string | 详细地址
contact_persons | contact_person_resource\[\] | 联系人信息
name | string | 姓名
position | string | 职位
email | string | 电子邮件
phone | string | 移动电话
telephone | string | 固定电话
selected | boolean | 是否被选中
bank_account_info_ids | bank_account_info\[\] | 银行账户列表选择
id | string | 通过银行账户id选择具体银行账号
value | string | 通过银行账号选择具体银行账号 (如果无法获取银行账号id)
sign_status | string | 签约状态<br>**可选值有**：<br>- NOT_START：未发起<br>- START_SUCCESS：发起成功<br>- START_FAIL：发起失败<br>- SIGN_SUCCESS：签约成功<br>- SIGN_FAIL：签约失败<br>- SIGN_DECLINE：拒绝签约
contract_budget_list | contract_budget_resource\[\] | 预算明细列表
budget_year | string | 预算年度
budget_code | string | 预算编码
budget_balance | number(float) | 预算余额
budget_balance_currency | string | 预算余额币种。参见：[币种枚举值](https://open.feishu.cn/document/uAjLw4CM/ukTMukTMukTM/contract-v1/appendix/currency-type-enumeration-value)
budget_occupied_amount | number(float) | 预算占用金额(不含税）
budget_occupied_amount_currency | string | 预算占用金额币种。参见：[币种枚举值](https://open.feishu.cn/document/uAjLw4CM/ukTMukTMukTM/contract-v1/appendix/currency-type-enumeration-value)
tax_rate | number(float) | 税率
tax_amount | number(float) | 税额
tax_amount_currency | string | 税额币种。参见：[币种枚举值](https://open.feishu.cn/document/uAjLw4CM/ukTMukTMukTM/contract-v1/appendix/currency-type-enumeration-value)
source_id | string | 外部导入的预算明细原始id
uuid | string | 合同组下同一预算的唯一id
contract_budget_id | string | 预算id
budget_department_id | string | 预算部门id
budget_department_name | string | 预算部门名称
budget_department_info | string | 预算部门信息
budget_subject_code | string | 预算科目编号
budget_subject_name | string | 预算科目名称
budget_subject_info | string | 预算科目信息
cost_center_code | string | 成本中心编码
cost_center_name | string | 成本中心名称
cost_center_info | string | 成本中心信息
budget_code_name | string | 预算编码名称
remark | string | 备注
extra_info | string | 额外信息
contract_center_group_code | string | 成本中心组编码
cost_center_group_name | string | 成本中心组名称
cost_center_group_info | string | 成本中心组信息
budget_taxed_amount | number(float) | 预算含税金额
budget_taxed_amount_currency | string | 预算含税金额币种。参见：[币种枚举值](https://open.feishu.cn/document/uAjLw4CM/ukTMukTMukTM/contract-v1/appendix/currency-type-enumeration-value)
payment_plan_list | payment_plan\[\] | 付款计划
payment_amount | number(float) | 付款金额
currency_code | string | 付款币种类型。参见：[币种枚举值](https://open.feishu.cn/document/uAjLw4CM/ukTMukTMukTM/contract-v1/appendix/currency-type-enumeration-value)
payment_date | string | 付款日期
payment_desc | string | 付款说明
payment_plan_id | string | 付款计划id
source_id | string | 外部导入的付款计划id
payment_custom_attributes | string | 付款计划自定义字段，格式参考 字段控件描述
payment_counter_party | payment_counter_party | 付款对象
counter_party_code | string | 付款对象主体编码
contract_status_code | int | 合同状态编码<br>**可选值有**：<br>- 0：正编辑<br>- 1：已作废<br>- 2：已撤回<br>- 3：审批中<br>- 4：已拒绝<br>- 6：签订中<br>- 8：归档中<br>- 9：已归档<br>- 10：变更中<br>- 11：已变更<br>- 16：终止中<br>- 17：已终止<br>- 23：已完成<br>- 30：协商中<br>- 31：协商草稿编辑中
contract_status_name | string | 合同状态名称
contract_category_number | string | 合同分类编码
contract_category_name | string | 合同分类名称
pay_type_code | int | 收支类型编码<br>**可选值有**：<br>- 0：未知<br>- 1：收入类<br>- 2：支出类<br>- 3：收入支出类<br>- 4：无金额
pay_type_name | string | 收支类型名称
start_date | string | 合同开始日期
end_date | string | 合同终止日期
submitted_time | string | 合同的提交时间
approved_time | string | 合同审批完成时间
signed_time | string | 合同签订完成时间
archived_time | string | 合同归档完成时间
submitter_user_id | string | 提交人id,默认指openId
owner_user_id | string | 合同所属人id，默认指openId
demand_user_ids | string\[\] | 合同需求人
department_id | string | 部门id
page_token | string | 分页标记，当 has_more 为 true 时，会同时返回新的 page_token，否则不返回 page_token
has_more | boolean | 是否还有更多项

### 响应体示例
```json
{"code":0,
"msg":"success",
"data":{"items":[{"create_user_id":"ou_8ebd4f35d7101ffdeb4771d7c8ec517e",
"create_user_name":"飞书合同管理员",
"contract_id":6982522710165307692,
"contract_number":"CT20210708000030",
"contract_name":"合同名称",
"amount":100,
"our_party_list":[{
    "our_party_id": "6990549883451080992",
    "our_party_name": "字节跳动",
    "our_party_code": "XYZ123",
    "our_party_type_code": 0,
    "our_party_sign_info_resource": {
        "enable": true,
        "seal_type_codes": "1",
        "seal_position_type_code": 1,
        "keyword": "keyword",
        "date_seal_enabled": true,
        "date_seal_keyword": "date",
        "personal_seal_enabled": true,
        "personal_seal_keyword": "小明",
        "cross_page_seal_enabled": true
    },
    "sign_status": "NOT_START"
}],
"counter_party_list":[{
    "counter_party_id": "6990561370928316705",
    "counter_party_name": "北京飞书科技有限公司",
    "counter_party_code": "ABC123",
    "business_address_info": {
        "id": "7091241261281640492",
        "value": "北京市海淀区知春路甲48号"
    },
    "bank_account_info": {
        "id": "7091234972182560812",
        "value": "123456123456"
    },
    "contact_info": {
        "id": "7091231161921339436",
        "value": "李四"
    },
    "counter_party_sign_info_resource": {
        "enable": true,
        "seal_type_codes": "1",
        "seal_position_type_code": 1,
        "keyword": "keyword",
        "date_seal_enabled": true,
        "date_seal_keyword": "date",
        "personal_seal_enabled": true,
        "personal_seal_keyword": "小明",
        "cross_page_seal_enabled": true,
        "signer_name": "小明",
        "signer_mobile": "123456",
        "signer_email": "123456@bytedance.com"
    },
    "bank_accounts": [
        {
            "account": "12213518889641",
            "account_name": "账户名",
            "bank_code": "001666666666",
            "bank_name": "中国人民银行",
            "country": "中国大陆",
            "selected": true
        }
    ],
    "register_address": {
        "country": "中国大陆",
        "province": "江西省",
        "city": "南昌",
        "detail_address": "江西省南昌市西湖区红谷滩1幢6楼"
    },
    "contact_persons": [
        {
            "name": "张三",
            "position": "总经理",
            "email": "1234565432@qq.com",
            "phone": "13245676531",
            "telephone": "0571-8316800",
            "selected": true
        }
    ],
    "bank_account_info_ids": [
        {
            "id": "7091234972182560812",
            "value": "123456123456"
        }
    ],
    "sign_status": "NOT_START"
}],
"contract_budget_list":[{
    "budget_year": "2012",
    "budget_code": "10010",
    "budget_balance": 100.01,
    "budget_balance_currency": "CNY",
    "budget_occupied_amount": 100.01,
    "budget_occupied_amount_currency": "CNY",
    "tax_rate": 0.14,
    "tax_amount": 100.01,
    "tax_amount_currency": "CNY",
    "source_id": "0001",
    "uuid": "550E8400-E29B-11D4-A716-446655440000",
    "contract_budget_id": "6990561370928316705",
    "budget_department_id": "0001",
    "budget_department_name": "科研部门",
    "budget_department_info": "预算部门信息",
    "budget_subject_code": "abc123",
    "budget_subject_name": "预算科目",
    "budget_subject_info": "信息",
    "cost_center_code": "abc123",
    "cost_center_name": "成本中心名称",
    "cost_center_info": "成本中心信息",
    "budget_code_name": "预算编码名称",
    "remark": "这是备注",
    "extra_info": "这是额外信息",
    "contract_center_group_code": "bac123",
    "cost_center_group_name": "成本中心组名称",
    "cost_center_group_info": "成本中心组信息",
    "budget_taxed_amount": 100.01,
    "budget_taxed_amount_currency": "CNY"
}],
"payment_plan_list":[{"payment_amount":100,
"currency_code":"CNY",
"payment_date":"2021-11-11",
"payment_desc":"说明",
"payment_plan_id":"6990561370928316705",
"source_id":"123",
"payment_custom_attributes":"[{\"module_name\":\"履约计划\",\"attribute_name\":\"单行文本测试\",\"attribute_value\":\"a sentence\"},{\"module_name\":\"开放平台测试模块\",\"attribute_name\":\"多行文本测试\",\"attribute_value\":\"a sentence\\n a sentence\\n a sentence\\n\"},{\"module_name\":\"开放平台测试模块\",\"attribute_name\":\"数字测试\",\"attribute_value\":1234},{\"module_name\":\"开放平台测试模块\",\"attribute_name\":\"日期测试\",\"attribute_value\":\"2022-04-06\"},{\"module_name\":\"开放平台测试模块\",\"attribute_name\":\"日期区间测试\",\"attribute_value\":{\"start_date\":\"2022-01-01\",\"end_date\":\"2022-03-31\"}}]"",
"payment_counter_party":{"counter_party_code":"V00104531"}}],
"contract_status_code":3,
"contract_status_name":"process",
"contract_category_number":"003003",
"contract_category_name":"技术咨询合同",
"pay_type_code":0,
"pay_type_name":"in",
"start_date":"2021-08-06",
"end_date":"2021-08-07",
"submitted_time":"1625746540",
"approved_time":"1625746540",
"signed_time":"1625746540",
"archived_time":"1625746540",
"submitter_user_id":"ou_8ebd4f35d7101ffdeb4771d7c8ec517e",
"owner_user_id":"ou_8ebd4f35d7101ffdeb4771d7c8ec517e",
"demand_user_ids":["0"],
"department_id":"od-5cefe25147a103456cf21a63b1132ad"}],
"page_token":"page_token",
"has_more":false}}
```

### 错误码

HTTP状态码 | 错误码 | 描述 | 排查建议
---|---|---|---
400 | 1480001 | Parameter error | 请检查参数是否填写正确